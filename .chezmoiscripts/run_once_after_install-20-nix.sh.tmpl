{{- if (eq .chezmoi.os "darwin") -}}
#!/bin/bash

# Define your configuration here
read -r -d '' CONFIG << EOM
# Generated by https://github.com/DeterminateSystems/nix-installer, version 0.8.0.
bash-prompt-prefix = (nix:$name)\040
build-users-group = nixbld
extra-nix-path = nixpkgs=flake:nixpkgs
experimental-features = nix-command flakes
auto-optimise-store = true

# cachix use nix-community
trusted-users = root zerodeth
EOM

# Check if the /etc/nix/nix.conf file exists
if [ ! -f "/etc/nix/nix.conf" ]; then
    echo "/etc/nix/nix.conf does not exist. Creating a new one..."
    sudo touch /etc/nix/nix.conf
fi

# Append configuration to the /etc/nix/nix.conf file and restart the service
echo "$CONFIG" | awk '{$1=$1};1' | sudo tee -a /etc/nix/nix.conf && sudo pkill nix-daemon

if [ $? -eq 0 ]
then
    echo "Configuration appended successfully and nix-daemon terminated."
else
    echo "Failed to append configuration."
fi

{{ end -}}
