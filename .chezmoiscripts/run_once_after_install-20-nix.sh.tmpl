{{- if (eq .chezmoi.os "darwin") -}}

#!/bin/bash

set -x

# Configuration lines
config_lines=(
"# Generated by https://github.com/DeterminateSystems/nix-installer, version 0.8.0."
"bash-prompt-prefix = (nix:\$name)\\040"
"build-users-group = nixbld"
"extra-nix-path = nixpkgs=flake:nixpkgs"
"experimental-features = nix-command flakes"
"auto-optimise-store = true"
"trusted-users = root zerodeth # cachix use nix-community"
)

# If /etc/nix/nix.conf doesn't exist, create it
if [ ! -f "/etc/nix/nix.conf" ]; then
    echo "/etc/nix/nix.conf didn't exist, creating..."
    sudo touch /etc/nix/nix.conf
fi

# Check each line of configuration â€“ if it doesn't already exist in nix.conf file, add it
for line in "${config_lines[@]}"; do
    if ! grep -Fxq "$line" /etc/nix/nix.conf; then
        echo "$line" | sudo tee -a /etc/nix/nix.conf
    fi
done

# Kill nix-daemon
sudo pkill nix-daemon

{{ end -}}
